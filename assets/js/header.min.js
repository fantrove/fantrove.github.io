// header.min.js
// ✅ ปรับปรุง: Parallel module loading, improved error handling
(function() {
    const MODULE_BASE = './header-modules/';
    
    const MODULES = [
        'overlay.js',
        'utils.js',
        'dataManager.js',
        'contentLoadingManager.js',
        'contentManager.js',
        'managers.js',
        'unifiedCopyToClipboard.js',
        'init.js'
    ];
    
    async function loadAll() {
        try {
            // Parallel module loading
            const imports = MODULES.map(m => import(MODULE_BASE + m));
            const mods = await Promise.all(imports);
            
            // Find and execute init
            const init = mods.find(m => m && m.init) || mods[mods.length - 1];
            if (init && typeof init.init === 'function') {
                await init.init();
            } else if (typeof window.headerV2_initializeApp === 'function') {
                await window.headerV2_initializeApp();
            }
        } catch (err) {
            console.error('header.min.js bootstrap error', err);
            try {
                if (window._headerV2_utils && window._headerV2_utils.showNotification) {
                    window._headerV2_utils.showNotification('โหลด header modules ไม่สำเร็จ', 'error');
                }
            } catch {}
        } finally {
            try {
                if (typeof window.__removeInstantLoadingOverlay === 'function' && window.__instantLoadingOverlayShown) {
                    window.__removeInstantLoadingOverlay();
                    window.__instantLoadingOverlayShown = false;
                }
            } catch {}
        }
    }
    
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', loadAll);
    } else {
        loadAll();
    }
})();